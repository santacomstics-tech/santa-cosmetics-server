<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Santa Cosmetics - Productos</title>
  <link rel="stylesheet" href="css/estilos.css" />
  <style>
    #modal-envio {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none; justify-content: center; align-items: center;
      z-index: 1000;
    }
    #modal-envio .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 420px;
      width: 92%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    #modal-envio input, #modal-envio select {
      width: 100%;
      padding: 10px;
      margin-bottom: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    #modal-envio button {
      background-color: #c27ba0;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
    }

    .modal { display:none; position:fixed; inset:0; align-items:center; justify-content:center; background: rgba(0,0,0,0.5); z-index:999; }
    .modal .modal-content { background:#fff; padding:18px; border-radius:10px; max-width:600px; width:92%; max-height:80vh; overflow:auto; }
    .close-modal { float:right; background:transparent; border:none; font-size:16px; cursor:pointer; }

    .paleta { display:flex; flex-wrap:wrap; gap:8px; }
    .tono-card { display:flex; align-items:center; gap:8px; padding:6px; border-radius:6px; cursor:pointer; border:1px solid #eee; }
    .tono-swatch { width:28px; height:28px; border-radius:4px; border:1px solid #ccc; }

    .pago-overlay{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:1001;}
  </style>
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <h1 class="logo">Santa Cosmetics</h1>
    <nav class="main-nav">
      <a href="index.html">Inicio</a>
      <a href="productos.html" class="activo">Productos</a>
      <a href="https://www.facebook.com/santa.cosmetic.706367" target="_blank">Facebook</a>
      <a href="https://www.instagram.com/santacosmetic/" target="_blank">Instagram</a>
    </nav>
  </div>
</header>

<main class="container">
  <h2>Nuestros Productos</h2>

  <div class="productos-grid">
      <!-- 1 Alisadora (sobre) -->
      <div class="card producto" data-selection="Ninguno" data-base="7300">
        <img src="img/alisadora en sobre.jpg" alt="Alisadora Mega Growth">
        <h4>Alisadora en Sobre Mega Growth</h4>
        <p class="precio">$7.300</p>
        <p class="descripcion">Sistema de alisado MegaGrowth con aceites naturales y prote√≠nas. $7.300 por sobre.</p>
        <div class="botones-producto">
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 2 Cepillo Secador -->
      <div class="card producto" data-selection="Ninguno" data-base="55000">
        <img src="img/cepillo secador.jpg" alt="Cepillo Secador">
        <h4>Cepillo Secador Avocado 3D Power</h4>
        <p class="precio">$55.000</p>
        <p class="descripcion">√ösalo en cabello seco o h√∫medo. Potencia 2000W.</p>
        <div class="botones-producto">
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 3 Gel Vibrante -->
      <div class="card producto" data-selection="Ninguno" data-base="4500">
        <img src="img/Gel vibrante .jpg" alt="Gel Vibrante Fawy">
        <h4>Gel Vibrante Fawy</h4>
        <p class="precio">$4.500</p>
        <p class="descripcion">Formulaci√≥n ideal para peinar. $4.500 / $9.500.</p>
        <div class="botones-producto">
          <button class="btn primary tamano">Seleccionar tama√±o</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 4 Repolarizador -->
      <div class="card producto" data-selection="Ninguno" data-base="3300">
        <img src="img/Repolarizador capilar 8 en 1.jpg" alt="Repolarizador Capilar">
        <h4>Repolarizador Capilar 8 en 1</h4>
        <p class="precio">$3.300</p>
        <p class="descripcion">Tres presentaciones: 30g, 90g y 300g.</p>
        <div class="botones-producto">
          <button class="btn primary tamano">Seleccionar tama√±o</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 5 Protector Solar -->
      <div class="card producto" data-selection="Ninguno" data-base="3800">
        <img src="img/protector_solar.jpg.jpg" alt="Protector Solar">
        <h4>Protector Solar en Sachet</h4>
        <p class="precio">$3.800</p>
        <p class="descripcion">Con color y sin color.</p>
        <div class="botones-producto">
          <button class="btn primary tono" data-paleta="protector">Seleccionar tono</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 6 Corrector L√≠quido -->
      <div class="card producto" data-selection="Ninguno" data-base="16000">
        <img src="img/corrector_liquido.jpg.jpg" alt="Corrector L√≠quido">
        <h4>Corrector L√≠quido #DulceBella</h4>
        <p class="precio">$16.000</p>
        <p class="descripcion">Alta cobertura.</p>
        <div class="botones-producto">
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 7 Corrector Alta Cobertura -->
      <div class="card producto" data-selection="Ninguno" data-base="20000">
        <img src="img/corrector_cobertura.jpg.jpg" alt="Corrector Alta Cobertura">
        <h4>Corrector Alta Cobertura</h4>
        <p class="precio">$20.000</p>
        <p class="descripcion">Vitamina E + √°cido hialur√≥nico.</p>
        <div class="botones-producto">
          <button class="btn primary tamano">Seleccionar tama√±o</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 8 Tintura -->
      <div class="card producto" data-selection="Ninguno" data-base="5300">
        <img src="img/tintura_color1.jpg.jpg" alt="Tintura Color-1">
        <h4>Tintura Color-1</h4>
        <p class="precio">$5.300</p>
        <p class="descripcion">Tintura en sobre o pote.</p>
        <div class="botones-producto">
          <button class="btn primary tamano">Seleccionar tama√±o</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 9 Pesta√±as -->
      <div class="card producto" data-selection="Ninguno" data-base="8000">
        <img src="img/pesta√±as.jpg" alt="Pesta√±as Nesura">
        <h4>Pesta√±as Nesura</h4>
        <p class="precio">$8.000</p>
        <p class="descripcion">10mm - 14mm / mixtas.</p>
        <div class="botones-producto">
          <button class="btn primary tamano">Seleccionar tama√±o</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- 10 Esmaltes -->
      <div class="card producto" data-selection="Ninguno" data-base="4800">
        <img src="img/esmalte para u√±as.jpg" alt="Esmaltes">
        <h4>Esmaltes para U√±as</h4>
        <p class="precio">$4.800</p>
        <p class="descripcion">150 tonos disponibles.</p>
        <div class="botones-producto">
          <button class="btn primary tono" data-paleta="esmalte">Seleccionar tono</button>
          <button class="btn primary agregar">Agregar</button>
          <button class="btn primary leer-mas">Leer m√°s</button>
        </div>
      </div>

      <!-- ... TODOS LOS PRODUCTOS SIGUEN AQU√ç HASTA EL 26 ... -->

    </div>
</main>

<!-- CARRITO -->
<aside class="carrito-box" id="carrito">
  <h3>Tu carrito üõçÔ∏è</h3>
  <ul id="carrito-items"></ul>
  <p>Total: <span id="total">$0</span></p>
  <button id="pagar" class="btn primary">Pagar</button>
  <button id="vaciar" class="btn">Vaciar carrito</button>
</aside>

<div class="pago-overlay" id="pago-overlay"></div>

<!-- MODALES PRINCIPALES -->
<div class="modal" id="modal-tamano">
  <div class="modal-content">
    <button class="close-modal" id="cerrarTamano">Cerrar</button>
    <h3>Selecciona tama√±o</h3>
    <div class="options" id="opciones-tamano"></div>
  </div>
</div>

<div class="modal" id="modal-tono">
  <div class="modal-content">
    <button class="close-modal" id="cerrarTono">Cerrar</button>
    <h3>Selecciona tono</h3>
    <div id="modal-tono-body"></div>
  </div>
</div>

<div class="modal" id="modal-tipos">
  <div class="modal-content">
    <button class="close-modal" id="cerrarTipos">Cerrar</button>
    <h3>Seleccionar Tipo</h3>
    <div id="opciones-tipos" class="options"></div>
  </div>
</div>

<!-- Modal Env√≠o -->
<div id="modal-envio">
  <div class="modal-content">
    <h3>Datos de Env√≠o</h3>
    <input id="nombre" placeholder="Nombre completo">
    <input id="ciudad" placeholder="Ciudad">
    <input id="direccion" placeholder="Direcci√≥n">
    <input id="telefono" placeholder="Tel√©fono">
    <input id="email" placeholder="Correo electr√≥nico">
    <button id="confirmarEnvio">Confirmar Pedido</button>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

  // CAMPOS DEL FORMULARIO
  const nombreInput = document.getElementById("nombre");
  const ciudadInput = document.getElementById("ciudad");
  const direccionInput = document.getElementById("direccion");
  const telefonoInput = document.getElementById("telefono");
  const emailInput = document.getElementById("email");

  /* ===============================
      DATOS DE TONOS / TAMA√ëOS
     =============================== */

  const tonosList = {
    "Protector Solar en Sachet": [
      {name:"Con color", hex:"#e6b89c"},
      {name:"Sin color", hex:"#f2efe9"}
    ],
    "Esmaltes para U√±as": [
      {name:"Rojo Cl√°sico", hex:"#c21807"},
      {name:"Rosa Pastel", hex:"#f8b7d6"},
      {name:"Fucsia", hex:"#d63384"},
      {name:"Violeta", hex:"#7e3aa6"},
      {name:"Azul Cielo", hex:"#61a8ff"},
      {name:"Verde Menta", hex:"#9be7c4"},
      {name:"Dorado", hex:"#e6c56d"},
      {name:"Negro Brillante", hex:"#222"},
      {name:"Nude Claro", hex:"#f7e6df"}
    ]
  };

  const tamanosMap = {
    "Gel Vibrante Fawy": [["Pote 130g", 4500], ["Pote 370g", 9500]],
    "Repolarizador Capilar 8 en 1": [["30g", 3300], ["90g", 8600], ["300g", 26000]],
    "Tintura Color-1": [["Sobre", 5300], ["Pote", 31700]],
    "Pesta√±as Nesura": [["10mm", 8000], ["12mm", 9000], ["14mm", 9000], ["Mixtas", 9000]],
    "Corrector Alta Cobertura": [["Standard", 20000]]
  };

  function formatPrice(n){ return "$" + Number(n).toLocaleString(); }

  /* ===============================
        CARRITO
     =============================== */

  let cart = [];
  const carritoItemsEl = document.getElementById("carrito-items");
  const totalSpan = document.getElementById("total");

  function renderCart(){
    carritoItemsEl.innerHTML = "";
    let total = 0;
    cart.forEach(item=>{
      const li = document.createElement("li");
      li.textContent = `${item.name}${item.selection !== "Ninguno" ? " ("+item.selection+")" : ""} - ${formatPrice(item.price)}`;
      carritoItemsEl.appendChild(li);
      total += item.price;
    });
    totalSpan.textContent = formatPrice(total);
  }

  function addToCart(card){
    const name = card.querySelector("h4").textContent.trim();
    const price = parseInt(card.getAttribute("data-base")) || 0;
    const selection = card.getAttribute("data-selection") || "Ninguno";
    cart.push({ name, price, selection });
    renderCart();
  }

  /* ===============================
        EVENTOS PRINCIPALES
     =============================== */

  document.addEventListener("click", (e)=>{

    // AGREGAR
    if(e.target.matches(".agregar")){
      addToCart(e.target.closest(".producto"));
      return;
    }

    // LEER M√ÅS
    if(e.target.matches(".leer-mas")){
      const desc = e.target.closest(".producto").querySelector(".descripcion");
      desc.style.display = desc.style.display === "block" ? "none" : "block";
      e.target.textContent = desc.style.display === "block" ? "Ocultar" : "Leer m√°s";
      return;
    }

    // TAMA√ëO
    if(e.target.matches(".tamano")){
      const card = e.target.closest(".producto");
      const name = card.querySelector("h4").textContent.trim();
      const lista = tamanosMap[name] || [];
      const cont = document.getElementById("opciones-tamano");
      cont.innerHTML = "";

      lista.forEach(([label, precio])=>{
        const b = document.createElement("button");
        b.className = "option-btn";
        b.textContent = `${label} ‚Äî ${formatPrice(precio)}`;
        b.onclick = ()=>{
          card.setAttribute("data-selection", "Tama√±o: " + label);
          card.setAttribute("data-base", precio);
          card.querySelector(".precio").textContent = formatPrice(precio);
          document.getElementById("modal-tamano").style.display = "none";
        };
        cont.appendChild(b);
      });

      document.getElementById("modal-tamano").style.display = "flex";
      return;
    }

    // TONO
    if(e.target.matches(".tono")){
      const card = e.target.closest(".producto");
      const paleta = e.target.getAttribute("data-paleta");

      const cont = document.getElementById("modal-tono-body");
      cont.innerHTML = "";

      const tonos = tonosList["Esmaltes para U√±as"];

      tonos.forEach(t=>{
        const item = document.createElement("div");
        item.className = "tono-card";
        item.innerHTML = `
          <div class="tono-swatch" style="background:${t.hex}"></div>
          <div>${t.name}</div>
        `;
        item.onclick = ()=>{
          card.setAttribute("data-selection", "Tono: " + t.name);
          document.getElementById("modal-tono").style.display = "none";
        };
        cont.appendChild(item);
      });

      document.getElementById("modal-tono").style.display = "flex";
      return;
    }

  });

  /* ===============================
        BOTONES DEL CARRITO
     =============================== */

  document.getElementById("vaciar").onclick = ()=>{
    cart = [];
    renderCart();
  };

  document.getElementById("pagar").onclick = ()=>{
    if(cart.length === 0) return alert("Tu carrito est√° vac√≠o");
    document.getElementById("modal-envio").style.display = "flex";
  };

  /* ===============================
        CONFIRMAR PEDIDO
     =============================== */

  document.getElementById("confirmarEnvio").onclick = async ()=>{

    const nombre = nombreInput.value.trim();
    const ciudad = ciudadInput.value.trim();
    const direccion = direccionInput.value.trim();
    const telefono = telefonoInput.value.trim();
    const email = emailInput.value.trim();

    if(!nombre || !ciudad || !direccion || !telefono || !email){
      return alert("Completa todos los campos.");
    }

    const items = cart.map(i => `${i.name} - ${formatPrice(i.price)}`);
    const total = cart.reduce((t,i)=>t+i.price,0);

    const payload = {
      carrito: items,
      total,
      cliente: {nombre, ciudad, direccion, telefono, email}
    };

    try{
      const res = await fetch("https://santa-cosmetics-server.onrender.com/checkout",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(payload)
      });

      const data = await res.json();

      if(data.success){
        alert("Pedido enviado con √©xito.");
        cart = [];
        renderCart();
        document.getElementById("modal-envio").style.display = "none";
      }else{
        alert("Error: " + data.error);
      }

    }catch(e){
      alert("Error al conectar con el servidor.");
      console.error(e);
    }
  };

});
</script>
</body>
</html>